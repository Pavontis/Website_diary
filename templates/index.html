<!DOCTYPE html>
<html lang="ru">
   <head>
      <meta charset="UTF-8">
      <title>–ú–æ–π —Å–ø–∏—Å–æ–∫ –¥–µ–ª</title>
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
   </head>
   <body class="bg-light">
      <div class="d-flex">
         {% include 'navbar.html' %}
         <div class="container-fluid p-4">
            <div class="d-flex justify-content-between align-items-center mb-4">
               <div class="fw-bold">
                  üëã –ü—Ä–∏–≤–µ—Ç, {{current_user.username}}!
               </div>
               <a href="{{ url_for('logout') }}" class="btn btn-outline-danger btn-sm">–í—ã–π—Ç–∏</a>
            </div>
            <h1 class="mb-4">üìù –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏</h1>
            <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ -->
            <form action="/add" method="POST" enctype="multipart/form-data" class="card p-4 shadow-sm mb-4">
               <div class="mb-3">
                  <input type="text" class="form-control" name="title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏" required>
               </div>
               <div class="mb-3">
                  <select class="form-select" name="tag">
                     <option value="" selected disabled>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                     <option value="–†–∞–±–æ—Ç–∞">–†–∞–±–æ—Ç–∞</option>
                     <option value="–î–æ–º">–î–æ–º</option>
                     <option value="–£—á—ë–±–∞">–£—á—ë–±–∞</option>
                     <option value="–õ–∏—á–Ω–æ–µ">–õ–∏—á–Ω–æ–µ</option>
                     <option value="–î—Ä—É–≥–æ–µ">–î—Ä—É–≥–æ–µ</option>
                  </select>
               </div>
               <div class="mb-3">
                  <textarea class="form-control" name="description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏"></textarea>
               </div>
               <div class="mb-3">
                  <input type="datetime-local" class="form-control" name="due_date" id="dueDateInput">
                  <div class="form-check mt-2">
                     <input class="form-check-input" type="checkbox" id="allDayCheck">
                     <label class="form-check-label" for="allDayCheck">
                     –í–µ—Å—å –¥–µ–Ω—å
                     </label>
                  </div>
               </div>
               <div class="mb-3">
                  <input type="file" name="attachments" class="form-control" multiple>
               </div>
               <button type="submit" class="btn btn-dark">–î–æ–±–∞–≤–∏—Ç—å</button>
            </form>
            <script>
               const checkbox = document.getElementById('allDayCheck');
               const datetimeInput = document.getElementById('dueDateInput');

               checkbox.addEventListener('change', () => {
                   if (checkbox.checked) {
                       datetimeInput.type = 'date';
                   } else {
                       datetimeInput.type = 'datetime-local';
                   }
               });
            </script>
            <!-- –ü–æ–∏—Å–∫ -->
            <form method="GET" action="/" class="d-flex mb-4">
               <input type="text" class="form-control me-2" name="search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é..." value="{{ request.args.get('search', '') }}">
               <button class="btn btn-outline-primary" type="submit">üîç –ù–∞–π—Ç–∏</button>
            </form>
            <!-- –§–∏–ª—å—Ç—Ä—ã -->
            <div class="mb-4">
               <strong>–§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É:</strong><br>
               <a href="{{ url_for('index') }}" class="btn btn-dark btn-sm {% if not request.args.get('filter') %}active{% endif %}">–í—Å–µ</a>
               <a href="{{ url_for('index', filter='active') }}" class="btn btn-outline-warning btn-sm {% if request.args.get('filter') == 'active' %}active{% endif %}">–ê–∫—Ç–∏–≤–Ω—ã–µ</a>
               <a href="{{ url_for('index', filter='done') }}" class="btn btn-outline-success btn-sm {% if request.args.get('filter') == 'done' %}active{% endif %}">–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ</a>
            </div>
            <div class="mb-4">
               <strong>–§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:</strong><br>
               <a href="{{ url_for('index') }}" class="btn btn-dark btn-sm {% if not request.args.get('tag') %}active{% endif %}">–í—Å–µ</a>
               {% for cat in ['–†–∞–±–æ—Ç–∞', '–î–æ–º', '–£—á—ë–±–∞', '–õ–∏—á–Ω–æ–µ', '–î—Ä—É–≥–æ–µ'] %}
               <a href="{{ url_for('index', tag=cat) }}" class="btn btn-outline-primary btn-sm {% if request.args.get('tag') == cat %}active{% endif %}">{{ cat }}</a>
               {% endfor %}
            </div>
            <!-- –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á -->
            <div class="row">
               {% for task in tasks %}
               <div class="col-12 mb-3">
                  <div class="card shadow-sm border-0">
                     <div class="card-body d-flex justify-content-between align-items-center">
                        <div>
                           <h5 class="card-title mb-1">{{ task.title }}</h5>
                           {% if task.tag %}
                           <span class="badge bg-secondary rounded-pill">{{ task.tag }}</span>
                           {% endif %}
                           <p class="card-text text-muted mb-1">{{ task.description }}</p>
                           {% if task.due_date %}
                           <small class="text-muted">–°—Ä–æ–∫: {{ task.due_date.replace('T', ' ') if 'T' in task.due_date else task.due_date }}</small><br>
                           {% endif %}
                           {% if task.is_done %}
                           <span class="badge bg-success mt-2">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</span>
                           {% elif task.is_overdue %}
                           <span class="badge bg-danger mt-2">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</span>
                           {% elif task.due_soon %}
                           <span class="badge bg-warning text-dark mt-2">{{ task.due_soon }}</span>
                           {% endif %}
                        </div>
                        <div>
                           {% if not task.is_done %}
                           <a href="/done/{{ task.id }}" class="btn btn-outline-success btn-sm me-1">‚úì</a>
                           {% endif %}
                           <a href="/view/{{ task.id }}" class="btn btn-outline-info btn-sm me-1">üëÅ</a>
                           <a href="/edit/{{ task.id }}" class="btn btn-outline-primary btn-sm me-1">‚úèÔ∏è</a>
                           <a href="/delete/{{ task.id }}" class="btn btn-outline-danger btn-sm">üóëÔ∏è</a>
                        </div>
                     </div>
                  </div>
               </div>
               {% endfor %}
            </div>
         </div>
      </div>
   </body>
</html>